# Cloudflare Workers configuration
name = "metacord-dev"
main = "src/worker.ts"
compatibility_date = "2026-01-21"

[assets]
directory = "dist"
binding = "ASSETS"
not_found_handling = "single-page-application"
run_worker_first = true

# Durable Objects
[[durable_objects.bindings]]
name = "DISCORD_RATE_LIMITER"
class_name = "DiscordRateLimiter"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["DiscordRateLimiter"]

# KV Namespaces (dev — overridden in [env.production])
kv_namespaces = [
  { binding = "SESSIONS", id = "9f586389e8db4eea83367ad19c46f749" }
]

# Environment variables (dev — overridden in [env.production])
# Secrets must be set via `wrangler secret put <NAME>`:
#   - For dev (top-level):   wrangler secret put <NAME>
#   - For production:        wrangler secret put <NAME> --env production
#   Required secrets:
#     - DISCORD_CLIENT_SECRET
#     - SESSION_SECRET (generate with: openssl rand -hex 32)

[vars]
DISCORD_CLIENT_ID = "1463316345633374269"
DISCORD_REDIRECT_URI = "https://dev.metacord.app/api/auth/callback"

[env.production]
# Production environment (main branch)
# Worker name: metacord-prod
# Custom domain: metacord.app
# Deploy with: pnpm run deploy
name = "metacord-dev"
kv_namespaces = [
  { binding = "SESSIONS", id = "89d6fd289f654bfc802fc9a3eb2e4cd6" }
]

[[env.production.durable_objects.bindings]]
name = "DISCORD_RATE_LIMITER"
class_name = "DiscordRateLimiter"

[env.production.vars]
DISCORD_CLIENT_ID = "1463314254664040501"
DISCORD_REDIRECT_URI = "https://metacord.app/api/auth/callback"
