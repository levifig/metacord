# Cloudflare Workers configuration
name = "metacord-dev"
main = "src/worker.ts"
compatibility_date = "2026-01-21"

[assets]
directory = "dist"
binding = "ASSETS"
not_found_handling = "single-page-application"
run_worker_first = true

# Environment variables
# For local development, DISCORD_REDIRECT_URI defaults to http://localhost:8787/api/auth/callback
# For production/dev, set these in Cloudflare Workers dashboard or via wrangler secret:
#   - DISCORD_CLIENT_ID
#   - DISCORD_CLIENT_SECRET
#   - SESSION_SECRET (generate with: openssl rand -hex 32)
#   - DISCORD_REDIRECT_URI (https://metacord.app/api/auth/callback or https://dev.metacord.app/api/auth/callback)

[env.production]
# Production environment (main branch)
# Worker name: metacord-prod
# Custom domain: metacord.app
# Deploy with: pnpm run deploy
name = "metacord-dev"
kv_namespaces = [
  { binding = "SESSIONS", id = "89d6fd289f654bfc802fc9a3eb2e4cd6" }
]

[env.production.vars]
DISCORD_REDIRECT_URI = "https://metacord.app/api/auth/callback"

[env.development]
# Development environment (dev branch)
# Worker name: metacord-dev
# Custom domain: dev.metacord.app
# Deploy with: pnpm run deploy:dev
name = "metacord-dev"
kv_namespaces = [
  { binding = "SESSIONS", id = "9f586389e8db4eea83367ad19c46f749" }
]

[env.development.vars]
DISCORD_REDIRECT_URI = "https://dev.metacord.app/api/auth/callback"
